<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>베이컨 토마토 디럭스 햄버거 가격은 얼마?</title>
    <style>
        /* 1. Global Resets & Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                         Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            line-height: 1.6;
            background-color: #ffffff; /* 기본 흰색 배경 */
            color: #333;
            /* 터치 시 브라우저 기본 동작 방지 (선택적) */
            touch-action: none; /* 자체 스와이프 처리를 위해 브라우저 기본 제스처 비활성화 */
        }

        #app-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative; /* 자식 요소 포지셔닝 기준 */
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 1em;
            color: #2c3e50;
            text-align: center;
        }

        /* --- 터치 탐색 시뮬레이션용 --- */
        /* invisible-but-interactive 클래스: 시각적으로 투명하지만 공간 차지 및 이벤트 감지 */
        .invisible-but-interactive {
            opacity: 0 !important; /* 투명 처리 */
            /* background-color: rgba(255, 0, 0, 0.1); /* 디버깅용: 영역 확인 시 임시 사용 */
            /* border: 1px dashed red; /* 디버깅용: 영역 확인 시 임시 사용 */
            pointer-events: auto; /* 투명해도 이벤트 받도록 보장 (기본값이지만 명시) */
        }

        /* 2. Button Base Styles */
        .btn {
            display: block; /* 버튼 기본 block */
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            font-size: 1em;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border: 1px solid #e0e0e0; /* 투명 요소도 영역을 가지도록 테두리 유지 (필요시) */
            border-radius: 8px;
            transition: background-color 0.2s ease, transform 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            background-color: transparent; /* 투명 요소의 배경 제거 */
            color: transparent; /* 투명 요소의 텍스트 색상 제거 */
        }
         /* 보이는 버튼 예외 처리 */
         .btn:not(.invisible-but-interactive) {
             background-color: #f8f8f8;
             color: #333;
             border-color: #ccc;
         }

        .btn:active:not(.invisible-but-interactive) {
             transform: scale(0.98);
        }


        /* 3. Home Screen Specific Styles */
        /* 홈 화면 h1과 카테고리 버튼은 invisible-but-interactive 클래스가 적용됨 */
        #home-screen h1 {
             /* 공간 차지를 위한 스타일 유지 (padding, margin 등) */
             margin-bottom: 1.5em;
             border: none; /* 투명 요소 테두리 불필요 */
             background: none; /* 투명 요소 배경 불필요 */
        }
        .category-buttons .btn {
            /* 공간 차지를 위한 스타일 유지 (padding, margin 등) */
            box-shadow: none; /* 투명 요소 그림자 불필요 */
            border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
            background-color: transparent; /* 배경 제거 */
            color: transparent; /* 텍스트 제거 */
        }


        /* 4. Modal Styles */
        .modal {
            display: none; /* JS로 제어. 초기에는 레이아웃에 없음 */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(255, 255, 255, 0.9); /* 약간 불투명한 흰색 배경 (모달 열렸을 때) */
        }

        /* JS가 모달을 열 때 이 클래스를 추가한다고 가정 */
        .modal.modal-open {
            display: block;
        }

        /* JS가 모달 열 때 app-container에 이 클래스를 추가한다고 가정 */
        #app-container.modal-active #home-screen {
             display: none; /* 홈 화면 레이아웃에서 제거 */
        }

        .modal-content {
            position: relative;
            background-color: transparent; /* 모달 컨텐츠 배경 투명 처리 */
            margin: 10% auto;
            padding: 25px;
            border-radius: 10px;
            max-width: 90%;
            width: 500px;
            box-shadow: none; /* 그림자 제거 */
        }

        .modal-content h1 {
            /* 공간 차지를 위한 스타일 유지 */
            font-size: 1.3em;
            text-align: left;
            border-bottom: 1px solid #eee; /* 구분선은 유지 가능 (선택적) */
            padding-bottom: 0.5em;
            margin-bottom: 1em;
             border-color: transparent; /* 투명 요소 테두리 불필요 */
             background: none;
        }

        /* 5. Modal Button Specific Styles */
        /* 뒤로가기 버튼(.btn-back) */
        .modal-content .btn-back {
            width: auto;
            display: inline-block;
            padding: 8px 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
             /* invisible-but-interactive 클래스가 적용됨 */
             border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
             background-color: transparent;
             color: transparent;
        }

        /* "다음" 버튼 스타일 (시각적으로 보여야 함) */
        .modal-content .btn-next {
            opacity: 1; /* 확실히 보이도록 */
            background-color: #007bff; /* 파란색 배경 */
            color: white; /* 흰색 글자 */
            width: auto;
            display: inline-block; /* float 대신 사용 가능 */
            padding: 12px 25px;
            border: none; /* 테두리 제거 */
            position: relative; /* z-index 적용 가능하도록 */
            z-index: 1; /* 다른 투명 요소 위에 확실히 보이도록 */
        }

        .modal-content .btn-next:hover {
             background-color: #0056b3;
        }

        /* 모달 푸터 스타일 */
        .modal-footer {
             margin-top: 20px;
             padding-top: 15px;
             border-top: 1px solid #eee; /* 구분선 유지 */
             text-align: right; /* 다음 버튼 오른쪽 정렬 */
        }
         .modal-footer::after {
              content: "";
              clear: both;
              display: table;
         }

        /* 6. Checkbox Item Styles */
        .checkbox-item {
            /* invisible-but-interactive 클래스가 적용됨 */
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
            border-radius: 6px;
            background-color: transparent; /* 배경 제거 */
        }

        .checkbox-item input[type="checkbox"] {
            opacity: 0; /* 체크박스 자체도 투명하게 */
            margin-right: 12px;
            flex-shrink: 0;
            width: 1.2em;
            height: 1.2em;
            pointer-events: auto; /* 이벤트 받을 수 있도록 */
        }

        .checkbox-item label {
             opacity: 0; /* 라벨 텍스트도 투명하게 */
             flex-grow: 1;
             font-size: 0.95em;
             pointer-events: auto;
             /* color: transparent; /* invisible 클래스가 처리 */
        }

        /* 7. 알림 메시지 컨테이너 스타일 */
        #alert-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: none;
        }

        /* 화면에서 시각적으로 숨기되 스크린 리더는 접근 가능한 요소 */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* 현재 초점 있는 요소를 위한 스타일 (디버깅용) */
        .has-focus {
            /* 디버깅 시 활성화할 수 있는 스타일 */
            /* box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5); */
        }
    </style>
</head>
<body>
    <!-- 스크린 리더용 알림 메시지를 위한 영역 -->
    <div id="alert-container" role="alert" aria-live="assertive"></div>

    <div id="app-container">
        <div id="home-screen">
            <h1 class="invisible-but-interactive" tabindex="0">베이컨 토마토 디럭스 햄버거 가격은 얼마?</h1>
            <div class="category-buttons">
                <button id="btn-category-fresh" class="btn invisible-but-interactive" tabindex="0">신선 식품</button>
                <button id="btn-category-dairy" class="btn invisible-but-interactive" tabindex="0">요거트/유제품</button>
                <button id="btn-category-fastfood" class="btn invisible-but-interactive" tabindex="0">패스트푸드</button>
                <button id="btn-category-seafood" class="btn invisible-but-interactive" tabindex="0">수산물</button>
                <button id="btn-category-processed" class="btn invisible-but-interactive" tabindex="0">가공식품</button>
                <button id="btn-category-icecream" class="btn invisible-but-interactive" tabindex="0">아이스크림</button>
            </div>
        </div>

        <div id="modal-fresh" class="modal" aria-hidden="true" role="dialog" aria-label="신선 식품 카테고리">
            <div class="modal-content">
                 <button id="btn-back-from-fresh" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                 <h1 class="invisible-but-interactive" tabindex="0">신선 식품 카테고리</h1>
                <form id="form-fresh">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-1" name="fresh_items" value="15900" tabindex="0">
                        <label for="chk-fresh-1" id="lbl-fresh-1">GAP 인증 설향 딸기 500 그램 15,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-2" name="fresh_items" value="3500" tabindex="0">
                        <label for="chk-fresh-2" id="lbl-fresh-2">쌈채소 모듬 3,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-3" name="fresh_items" value="18800" tabindex="0">
                        <label for="chk-fresh-3" id="lbl-fresh-3">국내산 냉장 삼겹살 600 그램 18,800 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-4" name="fresh_items" value="16500" tabindex="0">
                        <label for="chk-fresh-4" id="lbl-fresh-4">노르웨이산 생연어 필렛 300 그램 16,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-5" name="fresh_items" value="5800" tabindex="0">
                        <label for="chk-fresh-5" id="lbl-fresh-5">동물복지 유정란 10구 5,800 원</label>
                    </div>
                     <div class="modal-footer">
                         <button type="button" id="btn-next-from-fresh" class="btn btn-next" tabindex="0">다음</button>
                     </div>
                </form>
            </div>
        </div>

        <div id="modal-dairy" class="modal" aria-hidden="true" role="dialog" aria-label="요거트/유제품 카테고리">
             <div class="modal-content">
                 <button id="btn-back-from-dairy" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                 <h1 class="invisible-but-interactive" tabindex="0">요거트/유제품 카테고리</h1>
                 <form id="form-dairy">
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-1" name="dairy_items" value="6900" tabindex="0">
                        <label for="chk-dairy-1" id="lbl-dairy-1">무가당 플레인 그릭 요거트 450 그램 6,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-2" name="dairy_items" value="3200" tabindex="0">
                        <label for="chk-dairy-2" id="lbl-dairy-2">떠먹는 딸기 요거트 85g*4 입 3,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-3" name="dairy_items" value="2950" tabindex="0">
                        <label for="chk-dairy-3" id="lbl-dairy-3">1등급 저지방 우유 900 밀리리터 2,950 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-4" name="dairy_items" value="5200" tabindex="0">
                        <label for="chk-dairy-4" id="lbl-dairy-4">간편 슬라이스 체다 치즈 270 그램 5,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-5" name="dairy_items" value="3800" tabindex="0">
                        <label for="chk-dairy-5" id="lbl-dairy-5">사과맛 요구르트 150 밀리리터 3,800 원</label>
                    </div>
                     <div class="modal-footer">
                         <button type="button" id="btn-next-from-dairy" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-fastfood" class="modal" aria-hidden="true" role="dialog" aria-label="패스트푸드 카테고리">
            <div class="modal-content">
                <button id="btn-back-from-fastfood" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">패스트푸드 카테고리</h1>
                <form id="form-fastfood">
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-1" name="fastfood_items" value="4500" tabindex="0">
                        <label for="chk-fastfood-1" id="lbl-fastfood-1">오리지널 비프 치즈버거 200그램 4,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-2" name="fastfood_items" value="7900" tabindex="0">
                        <label for="chk-fastfood-2" id="lbl-fastfood-2">콤비네이션 냉동 피자 한판 450그램 7,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-3" name="fastfood_items" value="11500" tabindex="0">
                        <label for="chk-fastfood-3" id="lbl-fastfood-3">바삭한 후라이드 치킨 순살 500그램 11,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-4" name="fastfood_items" value="6500" tabindex="0">
                        <label for="chk-fastfood-4" id="lbl-fastfood-4">베이컨 토마토 디럭스 햄버거 350 그램 6,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-5" name="fastfood_items" value="7800" tabindex="0">
                        <label for="chk-fastfood-5" id="lbl-fastfood-5">모짜렐라 크리스피 핫도그 5개입 425그램 7,800 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-fastfood" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="modal-seafood" class="modal" aria-hidden="true" role="dialog" aria-label="수산물 카테고리">
             <div class="modal-content">
                <button id="btn-back-from-seafood" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">수산물 카테고리</h1>
                 <form id="form-seafood">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-1" name="seafood_items" value="6900" tabindex="0">
                        <label for="chk-seafood-1" id="lbl-seafood-1">국내산 손질 고등어 특대 2마리 (400그램 내외) 6,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-2" name="seafood_items" value="12000" tabindex="0">
                        <label for="chk-seafood-2" id="lbl-seafood-2">동해안 생물 오징어 3마리 (600그램 내외) 12,000 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-3" name="seafood_items" value="22500" tabindex="0">
                        <label for="chk-seafood-3" id="lbl-seafood-3">자연산 냉동 흰다리새우 1킬로그램 22,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-4" name="seafood_items" value="8500" tabindex="0">
                        <label for="chk-seafood-4" id="lbl-seafood-4">국산 활 바지락 1킬로그램 8,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-5" name="seafood_items" value="11900" tabindex="0">
                        <label for="chk-seafood-5" id="lbl-seafood-5">노르웨이산 생연어회 슬라이스 180그램 11,900 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-seafood" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-processed" class="modal" aria-hidden="true" role="dialog" aria-label="가공식품 카테고리">
            <div class="modal-content">
                <button id="btn-back-from-processed" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">가공식품 카테고리</h1>
                 <form id="form-processed">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-1" name="processed_items" value="6700" tabindex="0">
                        <label for="chk-processed-1" id="lbl-processed-1">마일드 참치캔 150그램 4개 묶음 6,700 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-2" name="processed_items" value="5300" tabindex="0">
                        <label for="chk-processed-2" id="lbl-processed-2">짜지 않은 리치팜 햄 340그램 5,300 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-3" name="processed_items" value="4800" tabindex="0">
                        <label for="chk-processed-3" id="lbl-processed-3">얼큰한 해물맛 라면 5개입 4,800 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-4" name="processed_items" value="1900" tabindex="0">
                        <label for="chk-processed-4" id="lbl-processed-4">3분 비프 카레 순한맛 200그램 1,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-5" name="processed_items" value="6900" tabindex="0">
                        <label for="chk-processed-5" id="lbl-processed-5">종가집 맛김치 500그램 6,900 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-processed" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-icecream" class="modal" aria-hidden="true" role="dialog" aria-label="아이스크림 카테고리">
             <div class="modal-content">
                <button id="btn-back-from-icecream" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">아이스크림 카테고리</h1>
                 <form id="form-icecream">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-1" name="icecream_items" value="9500" tabindex="0">
                        <label for="chk-icecream-1" id="lbl-icecream-1">달콤 초코칩 아이스크림 파인트 474밀리리터 9,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-2" name="icecream_items" value="6200" tabindex="0">
                        <label for="chk-icecream-2" id="lbl-icecream-2">상큼 딸기 아이스 바 10개입 6,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-3" name="icecream_items" value="7500" tabindex="0">
                        <label for="chk-icecream-3" id="lbl-icecream-3">바삭 초코 크런치 아이스크림 콘 5개입 7,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-4" name="icecream_items" value="2000" tabindex="0">
                        <label for="chk-icecream-4" id="lbl-icecream-4">부드러운 쿠키 앤 크림 아이스 샌드 150밀리리터 2,000 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-5" name="icecream_items" value="8800" tabindex="0">
                        <label for="chk-icecream-5" id="lbl-icecream-5">미니 아이스크림 골라담기 8개 세트 8,800 원</label>
                    </div>
                     <div class="modal-footer">
                        <button type="button" id="btn-next-from-icecream" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- JavaScript 코드 -->
    <script>
        // 전역 변수 및 상태
        let lastFocusedElement = null;  // 마지막으로 포커스된 요소
        let lastTapTime = 0;            // 마지막 탭 시간
        let lastTapX = 0;               // 마지막 탭 X 좌표
        let lastTapY = 0;               // 마지막 탭 Y 좌표
        let tapTimer = null;            // 탭 타이머 ID
        const doubleTapDelay = 200;     // 더블 탭 인식 시간(ms)
        const tapDistanceThreshold = 20; // 두 탭 간 거리 임계값(px)
        let focusableElements = [];     // 현재 화면에서 포커스 가능한 요소들
        let currentFocusIndex = 0;      // 현재 포커스 요소의 인덱스
        let currentModal = null;        // 현재 열린 모달
        let isTTSInitialized = false;   // TTS 초기화 상태
        let isProcessingGesture = false; // 제스처 처리 중인지 여부

        // 구글 설문지 URL
        const googleFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdGuFNDeGYBBHT9Dby7o5Yp0YAmxxwg3njEfaR7uP1JYJipFw/viewform?usp=sharing";

        // TTS 초기화 및 음성 로드
        function initTTS() {
            return new Promise((resolve, reject) => {
                if (!('speechSynthesis' in window)) {
                    reject("브라우저가 음성 합성을 지원하지 않습니다.");
                    return;
                }

                const synth = window.speechSynthesis;
                
                // 음성 목록 이미 로드됐는지 확인
                let voices = synth.getVoices();
                if (voices.length > 0) {
                    console.log("음성 목록 즉시 로드됨", voices.length);
                    isTTSInitialized = true;
                    resolve(voices);
                    return;
                }
                
                // 음성 목록이 비어있으면 로드될 때까지 대기
                synth.onvoiceschanged = () => {
                    voices = synth.getVoices();
                    console.log("음성 목록 로드 완료", voices.length);
                    isTTSInitialized = true;
                    resolve(voices);
                };
                
                // 타임아웃 설정 (5초)
                setTimeout(() => {
                    if (voices.length === 0) {
                        console.error("음성 목록을 로드할 수 없습니다");
                        reject("음성 목록 로드 실패");
                    }
                }, 5000);
            });
        }

        // 텍스트 음성 출력 함수
        function speakText(text) {
            if (!text) return;
            
            // 현재 음성 출력 중지
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // 한국어 명시적 설정
            utterance.lang = 'ko-KR';
            
            // 한국어 음성 찾기 시도
            const synth = window.speechSynthesis;
            const voices = synth.getVoices();
            const koreanVoice = voices.find(voice => voice.lang === 'ko-KR');
            
            // 한국어 음성이 있으면 명시적으로 할당
            if (koreanVoice) {
                utterance.voice = koreanVoice;
            } else {
                console.warn("한국어 음성을 찾을 수 없습니다. 기본 음성을 사용합니다.");
            }
            
            // 기타 음성 속성 설정
            utterance.rate = 1.0;   // 속도
            utterance.pitch = 1.0;  // 음높이
            utterance.volume = 1.0; // 볼륨
            
            window.speechSynthesis.speak(utterance);
        }

        // 알림 메시지 표시 함수
        function showAlert(message) {
            const alertContainer = document.getElementById('alert-container');
            alertContainer.textContent = message;
            alertContainer.style.display = 'block';
            
            // 알림 메시지 TTS 출력
            speakText(message);
            
            // 3초 후 알림 메시지 숨김
            setTimeout(() => {
                alertContainer.style.display = 'none';
            }, 3000);
        }

        // 요소 정보 음성 출력 (요소 유형에 따라 다른 텍스트 출력)
        function speakElementInfo(element) {
            if (!element) return;
            
            let text = '';
            
            if (element.tagName === 'H1') {
                text = element.textContent;
            } else if (element.tagName === 'BUTTON') {
                text = `${element.textContent} 버튼`;
            } else if (element.tagName === 'INPUT' && element.type === 'checkbox') {
                const label = getElementLabel(element);
                text = `${label} 체크박스, ${element.checked ? '선택됨' : '선택되지 않음'}`;
            }
            
            speakText(text);
        }

        // 요소의 라벨 텍스트 가져오기
        function getElementLabel(element) {
            // id를 기반으로 label 찾기
            if (element.id) {
                const label = document.querySelector(`label[for="${element.id}"]`);
                if (label) return label.textContent.trim();
            }
            
            // 부모-자식 관계로 연결된 label 찾기
            const parentLabel = element.closest('label');
            if (parentLabel) {
                // label 내부 텍스트에서 input 자신을 제외한 텍스트 얻기
                const clone = parentLabel.cloneNode(true);
                const inputs = clone.querySelectorAll('input');
                inputs.forEach(input => input.remove());
                return clone.textContent.trim();
            }
            
            return '라벨 없음';
        }

        // 현재 화면에서 포커스 가능한 요소 목록 갱신
        function updateFocusableElements() {
            // 현재 보이는 컨테이너 찾기
            const container = currentModal ? 
                document.querySelector(`#${currentModal} .modal-content`) : 
                document.getElementById('home-screen');
            
            if (!container) return [];
            
            // 포커스 가능한 요소 선택 (h1, button, checkbox)
            const elements = Array.from(container.querySelectorAll('h1, button, input[type="checkbox"]'))
                .filter(element => {
                    // 요소가 화면에 보이는지 확인 (display: none이 아닌지)
                    const style = window.getComputedStyle(element);
                    return style.display !== 'none';
                });
            
            focusableElements = elements;
            return elements;
        }

        // 포커스 설정 함수
        function setFocus(element, shouldSpeak = true) {
            if (!element) return;
            
            // 이전 포커스 요소에서 상태 제거
            if (lastFocusedElement) {
                lastFocusedElement.classList.remove('has-focus');
            }
            
            // 새 요소에 포커스 설정
            element.classList.add('has-focus');
            lastFocusedElement = element;
            
            // 현재 포커스 인덱스 업데이트
            currentFocusIndex = focusableElements.indexOf(element);
            
            // 요소 정보 음성 출력 (옵션에 따라)
            if (shouldSpeak) {
                speakElementInfo(element);
            }
        }

        // 인덱스로 포커스 이동
        function setFocusByIndex(index) {
            if (index < 0 || index >= focusableElements.length) {
                return false;
            }
            
            setFocus(focusableElements[index]);
            return true;
        }

        // 이전 요소로 포커스 이동
        function focusPrevious() {
            if (currentFocusIndex <= 0) {
                showAlert("첫 번째 항목입니다");
                return false;
            }
            
            return setFocusByIndex(currentFocusIndex - 1);
        }

        // 다음 요소로 포커스 이동
        function focusNext() {
            if (currentFocusIndex >= focusableElements.length - 1) {
                showAlert("마지막 항목입니다");
                return false;
            }
            
            return setFocusByIndex(currentFocusIndex + 1);
        }

        // 첫 번째 요소에 포커스 설정
        function focusFirst() {
            if (focusableElements.length > 0) {
                return setFocusByIndex(0);
            }
            return false;
        }

        // 포커스된 요소 실행 함수
        function executeFocusedElement(element) {
            if (!element) return;
            
            // 요소 타입에 따른 적절한 실행
            if (element.tagName === 'BUTTON') {
                // 모달 관련 버튼 처리
                if (element.id.includes('btn-category-')) {
                    // 카테고리 버튼 클릭
                    const category = element.id.replace('btn-category-', '');
                    openModal(`modal-${category}`);
                    return;
                } else if (element.id.includes('btn-back-from-')) {
                    // 뒤로가기 버튼 클릭
                    closeModal();
                    return;
                } else if (element.id.includes('btn-next-from-')) {
                    // 다음 버튼 클릭 - 체크박스 선택 확인 후 설문 페이지로 이동
                    const category = element.id.replace('btn-next-from-', '');
                    const checkboxes = document.querySelectorAll(`#modal-${category} input[type="checkbox"]:checked`);
                    
                    if (checkboxes.length === 0) {
                        showAlert("상품을 선택해주세요");
                        return;
                    }
                    
                    // 구글 설문지로 이동
                    window.location.href = googleFormUrl;
                    return;
                }
                
                // 일반 버튼 클릭
                element.click();
            } else if (element.tagName === 'INPUT' && element.type === 'checkbox') {
                // 다른 모든 체크박스 해제
                const form = element.closest('form');
                if (form) {
                    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                    
                    // 이미 체크된 다른 체크박스가 있는지 확인
                    const alreadyChecked = Array.from(checkboxes).find(cb => cb !== element && cb.checked);
                    
                    if (alreadyChecked && !element.checked) {
                        // 다른 체크박스가 이미 선택되어 있으면 알림
                        showAlert("이미 하나의 상품을 선택하셨습니다");
                        return;
                    }
                    
                    // 모든 체크박스 해제
                    checkboxes.forEach(cb => {
                        if (cb !== element) cb.checked = false;
                    });
                }
                
                // 현재 체크박스 토글
                element.checked = !element.checked;
                
                // 상태 변경 음성 출력
                speakElementInfo(element);
            }
        }

        // 화면 위치에 있는 요소 찾기
        function getElementAtPosition(x, y) {
            return document.elementFromPoint(x, y);
        }

        // 요소가 포커스 가능한지 확인
        function isFocusable(element) {
            // 현재 포커스 가능한 요소 배열에 포함되어 있는지 확인
            return element && focusableElements.includes(element);
        }

        // 모달 열기
        function openModal(modalId) {
            // 이전 모달 닫기
            if (currentModal) {
                document.getElementById(currentModal).classList.remove('modal-open');
            }
            
            // 홈 화면 숨기기
            document.getElementById('app-container').classList.add('modal-active');
            
            // 새 모달 열기
            const modal = document.getElementById(modalId);
            modal.classList.add('modal-open');
            modal.setAttribute('aria-hidden', 'false');
            
            // 현재 모달 업데이트
            currentModal = modalId;
            
            // 포커스 가능한 요소 업데이트
            updateFocusableElements();
            
            // 첫 번째 요소에 포커스
            focusFirst();
        }

        // 모달 닫기
        function closeModal() {
            if (currentModal) {
                // 모달 닫기
                const modal = document.getElementById(currentModal);
                modal.classList.remove('modal-open');
                modal.setAttribute('aria-hidden', 'true');
                
                // 앱 컨테이너 클래스 제거
                document.getElementById('app-container').classList.remove('modal-active');
                
                // 현재 모달 초기화
                currentModal = null;
                
                // 포커스 가능한 요소 업데이트
                updateFocusableElements();
                
                // 첫 번째 요소에 포커스
                focusFirst();
            }
        }

        // 터치 이벤트 시작 처리
        function handleTouchStart(e) {
            // 브라우저 기본 동작 방지
            e.preventDefault();
            
            if (isProcessingGesture) return;
            
            const touch = e.touches[0];
            const currentTime = Date.now();
            const x = touch.clientX;
            const y = touch.clientY;
            
            // 이전 탭과의 시간 차이 계산
            const timeDiff = currentTime - lastTapTime;
            
            // 탭 간 거리 계산
            const distX = Math.abs(x - lastTapX);
            const distY = Math.abs(y - lastTapY);
            const isSameLocation = distX < tapDistanceThreshold && distY < tapDistanceThreshold;
            
            // 더블 탭 감지 (200ms 이내 + 같은 위치)
            if (timeDiff < doubleTapDelay && isSameLocation) {
                // 더블 탭으로 처리: 마지막으로 포커스된 요소 실행
                clearTimeout(tapTimer);
                tapTimer = null;
                
                if (lastFocusedElement) {
                    executeFocusedElement(lastFocusedElement);
                }
                
                // 더블 탭 후 값 초기화
                lastTapTime = 0;
                return;
            }
            
            // 첫 번째 탭 또는 다른 위치의 탭으로 처리
            // 즉시 포커스 설정하지 않고, 대기 타이머 설정
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => {
                // 200ms 동안 두 번째 탭이 없었으므로 싱글 탭으로 간주
                const elementAtPosition = getElementAtPosition(x, y);
                if (elementAtPosition && isFocusable(elementAtPosition)) {
                    setFocus(elementAtPosition);
                }
                tapTimer = null;
            }, doubleTapDelay);
            
            // 현재 탭 정보 저장
            lastTapTime = currentTime;
            lastTapX = x;
            lastTapY = y;
        }

        // 터치 이동 처리 (스와이프 감지)
        let touchStartX = 0;
        let touchStartY = 0;
        let isSwipeInProgress = false;

        function handleTouchMove(e) {
            if (isProcessingGesture) return;
            
            const touch = e.touches[0];
            const currentX = touch.clientX;
            const currentY = touch.clientY;
            
            // 스와이프 시작이 아직 기록되지 않았다면 기록
            if (!isSwipeInProgress) {
                touchStartX = currentX;
                touchStartY = currentY;
                isSwipeInProgress = true;
            }
        }

        // 터치 종료 처리 (스와이프 완료)
        function handleTouchEnd(e) {
            // 더블 탭 처리 중이면 스와이프 무시
            if (Date.now() - lastTapTime < doubleTapDelay) {
                isSwipeInProgress = false;
                return;
            }
            
            if (isSwipeInProgress && !isProcessingGesture) {
                isProcessingGesture = true;
                
                // 마지막 터치 위치 가져오기
                const touch = e.changedTouches[0];
                const endX = touch.clientX;
                const endY = touch.clientY;
                
                // 이동 거리 계산
                const deltaX = endX - touchStartX;
                const deltaY = endY - touchStartY;
                
                // 스와이프 감지를 위한 최소 거리
                const swipeThreshold = 50;
                
                // 수평 스와이프가 수직 스와이프보다 명확할 때
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > swipeThreshold) {
                    if (deltaX > 0) {
                        // 오른쪽 스와이프: 다음 요소로 이동
                        focusNext();
                    } else {
                        // 왼쪽 스와이프: 이전 요소로 이동
                        focusPrevious();
                    }
                }
                
                isSwipeInProgress = false;
                
                // 제스처 처리 완료 후 짧은 지연
                setTimeout(() => {
                    isProcessingGesture = false;
                }, 100);
            }
        }

        // 앱 초기화
        async function initApp() {
            try {
                // TTS 초기화
                await initTTS();
                console.log("TTS 초기화 완료");
                
                // 포커스 가능한 요소 업데이트
                updateFocusableElements();
                
                // 첫 번째 요소에 포커스
                focusFirst();
                
                // 카테고리 버튼 클릭 이벤트 설정
                document.querySelectorAll('.category-buttons .btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const category = this.id.replace('btn-category-', '');
                        openModal(`modal-${category}`);
                    });
                });
                
                // 뒤로가기 버튼 클릭 이벤트 설정
                document.querySelectorAll('.btn-back').forEach(button => {
                    button.addEventListener('click', closeModal);
                });
                
                // 다음 버튼 클릭 이벤트 설정
                document.querySelectorAll('.btn-next').forEach(button => {
                    button.addEventListener('click', function() {
                        const category = this.id.replace('btn-next-from-', '');
                        const checkboxes = document.querySelectorAll(`#modal-${category} input[type="checkbox"]:checked`);
                        
                        if (checkboxes.length === 0) {
                            showAlert("상품을 선택해주세요");
                            return;
                        }
                        
                        // 구글 설문지로 이동
                        window.location.href = googleFormUrl;
                    });
                });
                
                // 체크박스 클릭 이벤트 설정 (단일 선택 처리)
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            // 같은 폼 내 다른 체크박스 해제
                            const form = this.closest('form');
                            if (form) {
                                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                                checkboxes.forEach(cb => {
                                    if (cb !== this) cb.checked = false;
                                });
                            }
                        }
                    });
                });
                
                // 터치 이벤트 설정
                document.addEventListener('touchstart', handleTouchStart, { passive: false });
                document.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd, { passive: false });
                
            } catch (error) {
                console.error("앱 초기화 실패:", error);
                alert("앱을 초기화할 수 없습니다. 브라우저 설정을 확인해주세요.");
            }
        }

        // 페이지 로드 시 앱 초기화
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>