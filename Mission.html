<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>베이컨 토마토 디럭스 햄버거 가격은 얼마?</title>
    <style>
        /* 1. Global Resets & Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                         Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            line-height: 1.6;
            background-color: #ffffff; /* 기본 흰색 배경 */
            color: #333;
            /* 터치 시 브라우저 기본 동작 방지 (선택적) */
            touch-action: none; /* 자체 스와이프 처리를 위해 브라우저 기본 제스처 비활성화 */
        }

        #app-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative; /* 자식 요소 포지셔닝 기준 */
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 1em;
            color: #2c3e50;
            text-align: center;
        }

        /* --- 터치 탐색 시뮬레이션용 --- */
        /* invisible-but-interactive 클래스: 시각적으로 투명하지만 공간 차지 및 이벤트 감지 */
        .invisible-but-interactive {
            opacity: 0 !important; /* 투명 처리 */
            /* background-color: rgba(255, 0, 0, 0.1); /* 디버깅용: 영역 확인 시 임시 사용 */
            /* border: 1px dashed red; /* 디버깅용: 영역 확인 시 임시 사용 */
            pointer-events: auto; /* 투명해도 이벤트 받도록 보장 (기본값이지만 명시) */
        }

        /* 2. Button Base Styles */
        .btn {
            display: block; /* 버튼 기본 block */
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            font-size: 1em;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border: 1px solid #e0e0e0; /* 투명 요소도 영역을 가지도록 테두리 유지 (필요시) */
            border-radius: 8px;
            transition: background-color 0.2s ease, transform 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            background-color: transparent; /* 투명 요소의 배경 제거 */
            color: transparent; /* 투명 요소의 텍스트 색상 제거 */
        }
         /* 보이는 버튼 예외 처리 */
         .btn:not(.invisible-but-interactive) {
             background-color: #f8f8f8;
             color: #333;
             border-color: #ccc;
         }

        .btn:active:not(.invisible-but-interactive) {
             transform: scale(0.98);
        }


        /* 3. Home Screen Specific Styles */
        /* 홈 화면 h1과 카테고리 버튼은 invisible-but-interactive 클래스가 적용됨 */
        #home-screen h1 {
             /* 공간 차지를 위한 스타일 유지 (padding, margin 등) */
             margin-bottom: 1.5em;
             border: none; /* 투명 요소 테두리 불필요 */
             background: none; /* 투명 요소 배경 불필요 */
        }
        .category-buttons .btn {
            /* 공간 차지를 위한 스타일 유지 (padding, margin 등) */
            box-shadow: none; /* 투명 요소 그림자 불필요 */
            border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
            background-color: transparent; /* 배경 제거 */
            color: transparent; /* 텍스트 제거 */
        }


        /* 4. Modal Styles */
        .modal {
            display: none; /* JS로 제어. 초기에는 레이아웃에 없음 */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(255, 255, 255, 0.9); /* 약간 불투명한 흰색 배경 (모달 열렸을 때) */
        }

        /* JS가 모달을 열 때 이 클래스를 추가한다고 가정 */
        .modal.modal-open {
            display: block;
        }

        /* JS가 모달 열 때 app-container에 이 클래스를 추가한다고 가정 */
        #app-container.modal-active #home-screen {
             display: none; /* 홈 화면 레이아웃에서 제거 */
        }

        .modal-content {
            position: relative;
            background-color: transparent; /* 모달 컨텐츠 배경 투명 처리 */
            margin: 10% auto;
            padding: 25px;
            border-radius: 10px;
            max-width: 90%;
            width: 500px;
            box-shadow: none; /* 그림자 제거 */
        }

        .modal-content h1 {
            /* 공간 차지를 위한 스타일 유지 */
            font-size: 1.3em;
            text-align: left;
            border-bottom: 1px solid #eee; /* 구분선은 유지 가능 (선택적) */
            padding-bottom: 0.5em;
            margin-bottom: 1em;
             border-color: transparent; /* 투명 요소 테두리 불필요 */
             background: none;
        }

        /* 5. Modal Button Specific Styles */
        /* 뒤로가기 버튼(.btn-back) */
        .modal-content .btn-back {
            width: auto;
            display: inline-block;
            padding: 8px 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
             /* invisible-but-interactive 클래스가 적용됨 */
             border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
             background-color: transparent;
             color: transparent;
        }

        /* "다음" 버튼 스타일 (시각적으로 보여야 함) */
        .modal-content .btn-next {
            opacity: 1; /* 확실히 보이도록 */
            background-color: #007bff; /* 파란색 배경 */
            color: white; /* 흰색 글자 */
            width: auto;
            display: inline-block; /* float 대신 사용 가능 */
            padding: 12px 25px;
            border: none; /* 테두리 제거 */
            position: relative; /* z-index 적용 가능하도록 */
            z-index: 1; /* 다른 투명 요소 위에 확실히 보이도록 */
        }

        .modal-content .btn-next:hover {
             background-color: #0056b3;
        }

        /* 모달 푸터 스타일 */
        .modal-footer {
             margin-top: 20px;
             padding-top: 15px;
             border-top: 1px solid #eee; /* 구분선 유지 */
             text-align: right; /* 다음 버튼 오른쪽 정렬 */
        }
         .modal-footer::after {
              content: "";
              clear: both;
              display: table;
         }

        /* 6. Checkbox Item Styles */
        .checkbox-item {
            /* invisible-but-interactive 클래스가 적용됨 */
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            border: 1px solid #e0e0e0; /* 영역 유지를 위한 테두리 */
            border-radius: 6px;
            background-color: transparent; /* 배경 제거 */
        }

        .checkbox-item input[type="checkbox"] {
            opacity: 0; /* 체크박스 자체도 투명하게 */
            margin-right: 12px;
            flex-shrink: 0;
            width: 1.2em;
            height: 1.2em;
            pointer-events: auto; /* 이벤트 받을 수 있도록 */
        }

        .checkbox-item label {
             opacity: 0; /* 라벨 텍스트도 투명하게 */
             flex-grow: 1;
             font-size: 0.95em;
             pointer-events: auto;
             /* color: transparent; /* invisible 클래스가 처리 */
        }

        /* 7. 알림 메시지 컨테이너 스타일 */
        #alert-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: none;
            opacity: 0; /* 시각적으로 보이지 않음, 하지만 aria-live 역할은 유지 */
        }

        /* 화면에서 시각적으로 숨기되 스크린 리더는 접근 가능한 요소 */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* 현재 초점 있는 요소를 위한 스타일 (디버깅용) */
        .has-focus {
            /* 디버깅 시 활성화할 수 있는 스타일 */
            /* box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5); */
        }
    </style>
</head>
<body>
    <!-- 스크린 리더용 알림 메시지를 위한 영역 -->
    <div id="alert-container" role="alert" aria-live="assertive"></div>

    <div id="app-container">
        <div id="home-screen">
            <h1 class="invisible-but-interactive" tabindex="0">베이컨 토마토 디럭스 햄버거 가격은 얼마?</h1>
            <div class="category-buttons">
                <button id="btn-category-fresh" class="btn invisible-but-interactive" tabindex="0">신선 식품</button>
                <button id="btn-category-dairy" class="btn invisible-but-interactive" tabindex="0">요거트/유제품</button>
                <button id="btn-category-fastfood" class="btn invisible-but-interactive" tabindex="0">패스트푸드</button>
                <button id="btn-category-seafood" class="btn invisible-but-interactive" tabindex="0">수산물</button>
                <button id="btn-category-processed" class="btn invisible-but-interactive" tabindex="0">가공식품</button>
                <button id="btn-category-icecream" class="btn invisible-but-interactive" tabindex="0">아이스크림</button>
            </div>
        </div>

        <div id="modal-fresh" class="modal" aria-hidden="true" role="dialog" aria-label="신선 식품 카테고리">
            <div class="modal-content">
                 <button id="btn-back-from-fresh" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                 <h1 class="invisible-but-interactive" tabindex="0">신선 식품 카테고리</h1>
                <form id="form-fresh">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-1" name="fresh_items" value="15900" tabindex="0">
                        <label for="chk-fresh-1" id="lbl-fresh-1">GAP 인증 설향 딸기 500 그램 15,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-2" name="fresh_items" value="3500" tabindex="0">
                        <label for="chk-fresh-2" id="lbl-fresh-2">쌈채소 모듬 3,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-3" name="fresh_items" value="18800" tabindex="0">
                        <label for="chk-fresh-3" id="lbl-fresh-3">국내산 냉장 삼겹살 600 그램 18,800 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-4" name="fresh_items" value="16500" tabindex="0">
                        <label for="chk-fresh-4" id="lbl-fresh-4">노르웨이산 생연어 필렛 300 그램 16,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fresh-5" name="fresh_items" value="5800" tabindex="0">
                        <label for="chk-fresh-5" id="lbl-fresh-5">동물복지 유정란 10구 5,800 원</label>
                    </div>
                     <div class="modal-footer">
                         <button type="button" id="btn-next-from-fresh" class="btn btn-next" tabindex="0">다음</button>
                     </div>
                </form>
            </div>
        </div>

        <div id="modal-dairy" class="modal" aria-hidden="true" role="dialog" aria-label="요거트/유제품 카테고리">
             <div class="modal-content">
                 <button id="btn-back-from-dairy" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                 <h1 class="invisible-but-interactive" tabindex="0">요거트/유제품 카테고리</h1>
                 <form id="form-dairy">
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-1" name="dairy_items" value="6900" tabindex="0">
                        <label for="chk-dairy-1" id="lbl-dairy-1">무가당 플레인 그릭 요거트 450 그램 6,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-2" name="dairy_items" value="3200" tabindex="0">
                        <label for="chk-dairy-2" id="lbl-dairy-2">떠먹는 딸기 요거트 85g*4 입 3,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-3" name="dairy_items" value="2950" tabindex="0">
                        <label for="chk-dairy-3" id="lbl-dairy-3">1등급 저지방 우유 900 밀리리터 2,950 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-4" name="dairy_items" value="5200" tabindex="0">
                        <label for="chk-dairy-4" id="lbl-dairy-4">간편 슬라이스 체다 치즈 270 그램 5,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-dairy-5" name="dairy_items" value="3800" tabindex="0">
                        <label for="chk-dairy-5" id="lbl-dairy-5">사과맛 요구르트 150 밀리리터 3,800 원</label>
                    </div>
                     <div class="modal-footer">
                         <button type="button" id="btn-next-from-dairy" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-fastfood" class="modal" aria-hidden="true" role="dialog" aria-label="패스트푸드 카테고리">
            <div class="modal-content">
                <button id="btn-back-from-fastfood" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">패스트푸드 카테고리</h1>
                <form id="form-fastfood">
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-1" name="fastfood_items" value="4500" tabindex="0">
                        <label for="chk-fastfood-1" id="lbl-fastfood-1">오리지널 비프 치즈버거 200그램 4,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-2" name="fastfood_items" value="7900" tabindex="0">
                        <label for="chk-fastfood-2" id="lbl-fastfood-2">콤비네이션 냉동 피자 한판 450그램 7,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-3" name="fastfood_items" value="11500" tabindex="0">
                        <label for="chk-fastfood-3" id="lbl-fastfood-3">바삭한 후라이드 치킨 순살 500그램 11,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-4" name="fastfood_items" value="6500" tabindex="0">
                        <label for="chk-fastfood-4" id="lbl-fastfood-4">베이컨 토마토 디럭스 햄버거 350 그램 6,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-fastfood-5" name="fastfood_items" value="7800" tabindex="0">
                        <label for="chk-fastfood-5" id="lbl-fastfood-5">모짜렐라 크리스피 핫도그 5개입 425그램 7,800 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-fastfood" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="modal-seafood" class="modal" aria-hidden="true" role="dialog" aria-label="수산물 카테고리">
             <div class="modal-content">
                <button id="btn-back-from-seafood" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">수산물 카테고리</h1>
                 <form id="form-seafood">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-1" name="seafood_items" value="6900" tabindex="0">
                        <label for="chk-seafood-1" id="lbl-seafood-1">국내산 손질 고등어 특대 2마리 (400그램 내외) 6,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-2" name="seafood_items" value="12000" tabindex="0">
                        <label for="chk-seafood-2" id="lbl-seafood-2">동해안 생물 오징어 3마리 (600그램 내외) 12,000 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-3" name="seafood_items" value="22500" tabindex="0">
                        <label for="chk-seafood-3" id="lbl-seafood-3">자연산 냉동 흰다리새우 1킬로그램 22,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-4" name="seafood_items" value="8500" tabindex="0">
                        <label for="chk-seafood-4" id="lbl-seafood-4">국산 활 바지락 1킬로그램 8,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-seafood-5" name="seafood_items" value="11900" tabindex="0">
                        <label for="chk-seafood-5" id="lbl-seafood-5">노르웨이산 생연어회 슬라이스 180그램 11,900 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-seafood" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-processed" class="modal" aria-hidden="true" role="dialog" aria-label="가공식품 카테고리">
            <div class="modal-content">
                <button id="btn-back-from-processed" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">가공식품 카테고리</h1>
                 <form id="form-processed">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-1" name="processed_items" value="6700" tabindex="0">
                        <label for="chk-processed-1" id="lbl-processed-1">마일드 참치캔 150그램 4개 묶음 6,700 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-2" name="processed_items" value="5300" tabindex="0">
                        <label for="chk-processed-2" id="lbl-processed-2">짜지 않은 리치팜 햄 340그램 5,300 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-3" name="processed_items" value="4800" tabindex="0">
                        <label for="chk-processed-3" id="lbl-processed-3">얼큰한 해물맛 라면 5개입 4,800 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-4" name="processed_items" value="1900" tabindex="0">
                        <label for="chk-processed-4" id="lbl-processed-4">3분 비프 카레 순한맛 200그램 1,900 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-processed-5" name="processed_items" value="6900" tabindex="0">
                        <label for="chk-processed-5" id="lbl-processed-5">종가집 맛김치 500그램 6,900 원</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-next-from-processed" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                 </form>
            </div>
        </div>

        <div id="modal-icecream" class="modal" aria-hidden="true" role="dialog" aria-label="아이스크림 카테고리">
             <div class="modal-content">
                <button id="btn-back-from-icecream" class="btn btn-back invisible-but-interactive" tabindex="0">뒤로가기</button>
                <h1 class="invisible-but-interactive" tabindex="0">아이스크림 카테고리</h1>
                 <form id="form-icecream">
                     <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-1" name="icecream_items" value="9500" tabindex="0">
                        <label for="chk-icecream-1" id="lbl-icecream-1">달콤 초코칩 아이스크림 파인트 474밀리리터 9,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-2" name="icecream_items" value="6200" tabindex="0">
                        <label for="chk-icecream-2" id="lbl-icecream-2">상큼 딸기 아이스 바 10개입 6,200 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-3" name="icecream_items" value="7500" tabindex="0">
                        <label for="chk-icecream-3" id="lbl-icecream-3">바삭 초코 크런치 아이스크림 콘 5개입 7,500 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-4" name="icecream_items" value="2000" tabindex="0">
                        <label for="chk-icecream-4" id="lbl-icecream-4">부드러운 쿠키 앤 크림 아이스 샌드 150밀리리터 2,000 원</label>
                    </div>
                    <div class="checkbox-item invisible-but-interactive">
                        <input type="checkbox" id="chk-icecream-5" name="icecream_items" value="8800" tabindex="0">
                        <label for="chk-icecream-5" id="lbl-icecream-5">미니 아이스크림 골라담기 8개 세트 8,800 원</label>
                    </div>
                     <div class="modal-footer">
                        <button type="button" id="btn-next-from-icecream" class="btn btn-next" tabindex="0">다음</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript 코드 -->
    <script>
    /**
     * 모바일 스크린 리더 시뮬레이션
     * 
     * Touch Events API를 활용하여 시각 장애인용 스크린 리더 환경을 시뮬레이션하는 웹 애플리케이션
     * 사용자는 한 손가락 터치, 더블 탭, 스와이프 등의 제스처로 화면을 탐색합니다.
     */

    // 즉시 실행 함수로 전역 네임스페이스 오염 방지
    (function() {
      'use strict';

      /**
       * 1. SpeechManager: 음성 출력 관리
       * - TTS 초기화 및 설정(한국어, 볼륨 등)
       * - 요소 음성 출력 메서드
       * - 알림 메시지 음성 출력 메서드
       */
      const SpeechManager = {
        utterance: null,
        speaking: false,
        queue: [],
        lastFocusText: '', // 마지막으로 포커스된 요소의 텍스트
        
        init: function() {
          // TTS 지원 확인
          if (!window.speechSynthesis) {
            console.error('브라우저가 Speech Synthesis API를 지원하지 않습니다.');
            return false;
          }
          
          // 기본 음성 합성 객체 생성
          this.utterance = new SpeechSynthesisUtterance();
          this.utterance.lang = 'ko-KR'; // 한국어 설정
          this.utterance.pitch = 1;      // 기본 음높이
          this.utterance.rate = 1;       // 기본 속도
          this.utterance.volume = 1;     // 기본 볼륨
          
          // 음성 재생 상태 이벤트 리스너
          this.utterance.onend = () => {
            this.speaking = false;
            this.processQueue(); // 대기 중인 다음 메시지 처리
          };
          
          this.utterance.onerror = (e) => {
            console.error('TTS 오류:', e);
            this.speaking = false;
            this.processQueue(); // 오류 발생해도 다음 메시지 처리
          };
          
          return true;
        },
        
        // 텍스트를 음성으로 출력
        speak: function(text, priority = false) {
          if (!text) return;
          
          // 빠른 스와이프 최적화: 이전 음성과 동일한 요소면 출력 안함
          if (!priority && text === this.lastFocusText) {
            return;
          }
          
          // 우선순위 메시지이거나 포커스 변경 시 현재 음성 중단
          if (priority || (this.speaking && !this.isSpeakingAlert)) {
            window.speechSynthesis.cancel();
            this.speaking = false;
            
            // 우선순위 메시지는 기존 대기열 초기화
            if (priority) {
              this.queue = [];
            }
          }
          
          // 현재 말하는 중이면 대기열에 추가
          if (this.speaking) {
            // 알림이 아닌 일반 포커스 메시지의 경우, 최신 메시지만 유지
            if (!priority && this.queue.length > 0 && !this.isSpeakingAlert) {
              this.queue = [text]; // 이전 대기 메시지 제거하고 최신 메시지만 남김
            } else {
              this.queue.push(text);
            }
            return;
          }
          
          // 새 메시지 음성 출력
          this.utterance.text = text;
          this.speaking = true;
          this.isSpeakingAlert = priority; // 알림 메시지 여부 저장
          
          // 알림이 아닌 경우 마지막 포커스 텍스트 저장
          if (!priority) {
            this.lastFocusText = text;
          }
          
          window.speechSynthesis.speak(this.utterance);
        },
        
        // 대기열 처리
        processQueue: function() {
          if (this.queue.length > 0 && !this.speaking) {
            const nextText = this.queue.shift();
            this.speak(nextText);
          }
        },
        
        // 요소 정보 음성 출력
        speakElementInfo: function(element) {
          if (!element) return;
          
          let textToSpeak = '';
          
          // 요소 유형에 따른 처리
          if (element.tagName === 'INPUT' && element.type === 'checkbox') {
            // 체크박스의 선택 상태 확인
            const isChecked = element.checked ? '선택됨' : '선택되지 않음';
            
            // 연결된 label 찾기
            const label = document.querySelector(`label[for="${element.id}"]`);
            let labelText = '';
            
            if (label) {
              labelText = label.textContent.trim();
            }
            
            // 체크박스 정보 조합
            textToSpeak = `체크박스 ${labelText}, ${isChecked}`;
          } 
          else if (element.tagName === 'BUTTON') {
            textToSpeak = `${element.textContent.trim()} 버튼`;
          }
          else if (element.tagName === 'H1') {
            textToSpeak = element.textContent.trim();
          }
          else if (element.tagName === 'LABEL') {
            // label을 직접 클릭할 수도 있으므로 처리
            const checkboxId = element.getAttribute('for');
            if (checkboxId) {
              const checkbox = document.getElementById(checkboxId);
              if (checkbox) {
                const isChecked = checkbox.checked ? '선택됨' : '선택되지 않음';
                textToSpeak = `체크박스 ${element.textContent.trim()}, ${isChecked}`;
              } else {
                textToSpeak = element.textContent.trim();
              }
            } else {
              textToSpeak = element.textContent.trim();
            }
          }
          
          // 텍스트가 추출되었다면 말하기
          if (textToSpeak) {
            this.speak(textToSpeak);
          }
        },
        
        // 알림 메시지 음성 출력
        alert: function(message) {
          this.speak(message, true); // 알림은 우선순위 메시지로 처리
          
          // 알림 메시지 시각적 표시 (선택적)
          const alertContainer = document.getElementById('alert-container');
          if (alertContainer) {
            alertContainer.textContent = message;
            alertContainer.setAttribute('aria-hidden', 'false');
            alertContainer.style.display = 'block';
            
            // 3초 후 알림 숨기기
            setTimeout(() => {
              alertContainer.style.display = 'none';
              alertContainer.setAttribute('aria-hidden', 'true');
            }, 3000);
          }
        }
      };

      /**
       * 2. FocusManager: 초점 관리
       * - 포커스 가능한 요소 찾기
       * - 초점 이동 및 설정
       * - 모달 내 초점 관리
       */
      const FocusManager = {
        focusableElements: [], // 현재 컨테이너의 포커스 가능 요소 배열
        currentFocusIndex: -1, // 현재 포커스된 요소 인덱스
        currentContainer: null, // 현재 활성화된 컨테이너(홈 또는 모달)
        
        init: function() {
          // 초기 컨테이너 설정 (홈 화면)
          this.setCurrentContainer(document.getElementById('home-screen'));
        },
        
        // 현재 활성 컨테이너 설정 및 포커스 가능 요소 탐색
        setCurrentContainer: function(container) {
          if (!container) return;
          
          this.currentContainer = container;
          this.findFocusableElements();
          
          // 컨테이너가 바뀌면 첫 번째 요소에 포커스
          if (this.focusableElements.length > 0) {
            this.setFocus(0);
          }
        },
        
        // 포커스 가능한 요소 찾기
        findFocusableElements: function() {
          if (!this.currentContainer) return;
          
          // 포커스 가능한 요소 선택자
          const selector = 'h1[tabindex], button[tabindex], input[type="checkbox"][tabindex]';
          
          // 현재 컨테이너 내의 포커스 가능 요소 찾기
          this.focusableElements = Array.from(this.currentContainer.querySelectorAll(selector));
          this.currentFocusIndex = -1; // 초기화
        },
        
        // 인덱스로 포커스 설정
        setFocus: function(index) {
          if (index < 0 || index >= this.focusableElements.length) return;
          
          // 이전 포커스된 요소에서 클래스 제거
          if (this.currentFocusIndex >= 0 && this.currentFocusIndex < this.focusableElements.length) {
            this.focusableElements[this.currentFocusIndex].classList.remove('has-focus');
          }
          
          // 새 요소에 포커스 설정
          this.currentFocusIndex = index;
          const element = this.focusableElements[index];
          
          // 시각적 포커스 표시 (디버깅용, 기본적으로 비활성화)
          element.classList.add('has-focus');
          
          // 요소 정보 음성 출력
          SpeechManager.speakElementInfo(element);
        },
        
        // 요소에 포커스 설정
        setFocusOnElement: function(element) {
          const index = this.focusableElements.indexOf(element);
          if (index !== -1) {
            this.setFocus(index);
          }
        },
        
        // 다음/이전 요소로 포커스 이동
        moveFocus: function(direction) {
          // 방향: 1(다음) 또는 -1(이전)
          const newIndex = this.currentFocusIndex + direction;
          
          // 경계 확인
          if (newIndex < 0) {
            SpeechManager.alert('첫 번째 항목입니다');
            return;
          }
          
          if (newIndex >= this.focusableElements.length) {
            SpeechManager.alert('마지막 항목입니다');
            return;
          }
          
          // 새 인덱스로 포커스 이동
          this.setFocus(newIndex);
        },
        
        // 현재 포커스된 요소 반환
        getCurrentElement: function() {
          if (this.currentFocusIndex >= 0 && this.currentFocusIndex < this.focusableElements.length) {
            return this.focusableElements[this.currentFocusIndex];
          }
          return null;
        },
        
        // 터치 위치에 있는 요소 찾고 포커스 설정
        setFocusByTouch: function(x, y) {
          // 터치 위치에 있는 요소 찾기
          const element = document.elementFromPoint(x, y);
          if (!element) return;
          
          // 요소 자체 또는 부모가 탭 가능한지 확인
          let focusableElement = this.findFocusableParent(element);
          
          if (focusableElement) {
            // 현재 컨테이너에 속하는지 확인
            if (this.focusableElements.includes(focusableElement)) {
              this.setFocusOnElement(focusableElement);
            }
          }
        },
        
        // 포커스 가능한 부모 요소 찾기 (자신 포함)
        findFocusableParent: function(element) {
          let current = element;
          
          // 요소 자체가 포커스 가능한지 확인
          if (this.focusableElements.includes(current)) {
            return current;
          }
          
          // 부모 요소들 중에 포커스 가능한 요소 찾기
          while (current && current !== document.body) {
            // 부모가 체크박스 아이템 컨테이너인 경우 내부 체크박스 찾기
            if (current.classList.contains('checkbox-item')) {
              const checkbox = current.querySelector('input[type="checkbox"]');
              if (checkbox && this.focusableElements.includes(checkbox)) {
                return checkbox;
              }
            }
            
            // 부모 요소가 포커스 가능한지 확인
            if (this.focusableElements.includes(current)) {
              return current;
            }
            
            current = current.parentElement;
          }
          
          return null;
        }
      };

      /**
       * 3. TouchGestureManager: 터치 제스처 감지 및 처리
       * - 터치 이벤트 리스너 설정
       * - 탭, 더블 탭, 스와이프 감지
       */
      const TouchGestureManager = {
        startX: 0,
        startY: 0,
        startTime: 0,
        lastTapTime: 0,
        lastTapX: 0,
        lastTapY: 0,
        
        // 설정값
        doubleTapDelay: 300,     // 더블 탭 인식 시간(ms)
        doubleTapDistance: 20,   // 더블 탭 최대 거리(px)
        swipeThreshold: 50,      // 스와이프 최소 거리(px)
        swipeTimeLimit: 300,     // 스와이프 최대 시간(ms)
        
        init: function() {
          // 터치 이벤트 리스너 설정
          document.addEventListener('touchstart', this.handleTouchStart.bind(this));
          document.addEventListener('touchend', this.handleTouchEnd.bind(this));
          document.addEventListener('touchmove', this.handleTouchMove.bind(this));
        },
        
        // 터치 시작 처리
        handleTouchStart: function(e) {
          // 단일 터치만 처리
          if (e.touches.length !== 1) return;
          
          // 터치 시작 좌표 및 시간 기록
          this.startX = e.touches[0].clientX;
          this.startY = e.touches[0].clientY;
          this.startTime = Date.now();
          
          // 브라우저 기본 동작 방지 (pinch-zoom 등)
          e.preventDefault();
        },
        
        // 터치 이동 처리
        handleTouchMove: function(e) {
          // 필요시 처리 (현재는 특별한 처리 없음)
          e.preventDefault();
        },
        
        // 터치 종료 처리
        handleTouchEnd: function(e) {
          // 단일 터치만 처리
          if (e.changedTouches.length !== 1) return;
          
          // 터치 종료 정보
          const endX = e.changedTouches[0].clientX;
          const endY = e.changedTouches[0].clientY;
          const endTime = Date.now();
          
          // 제스처 판별 순서: 더블 탭 -> 스와이프 -> 단일 탭
          
          // 1. 더블 탭 확인
          const timeDiff = endTime - this.lastTapTime;
          const distanceX = Math.abs(endX - this.lastTapX);
          const distanceY = Math.abs(endY - this.lastTapY);
          
          if (timeDiff < this.doubleTapDelay && 
              distanceX < this.doubleTapDistance && 
              distanceY < this.doubleTapDistance) {
            // 더블 탭 감지됨
            this.handleDoubleTap(endX, endY);
            
            // 마지막 탭 정보 초기화하여 트리플 탭 방지
            this.lastTapTime = 0;
          } else {
            // 2. 스와이프 확인
            const deltaX = endX - this.startX;
            const deltaY = endY - this.startY; // Y축 이동 확인을 위해 추가
            const deltaTime = endTime - this.startTime;
            
            // 빠른 스와이프 감지 최적화: 
            // 수평 방향 움직임이 수직 방향보다 크고, 최소 임계값을 초과하는 경우
            const isHorizontalSwipe = Math.abs(deltaX) > Math.abs(deltaY);
            
            if (deltaTime < this.swipeTimeLimit && 
                isHorizontalSwipe && 
                Math.abs(deltaX) > this.swipeThreshold) {
              // 스와이프 감지됨 - 빠른 스와이프면 이전 음성 중단하고 새 포커스 읽기
              const isFastSwipe = deltaTime < (this.swipeTimeLimit / 2);
              
              if (deltaX > 0) {
                // 오른쪽 스와이프
                this.handleSwipe('right', isFastSwipe);
              } else {
                // 왼쪽 스와이프
                this.handleSwipe('left', isFastSwipe);
              }
            } else {
              // 3. 단일 탭 처리
              // 터치한 위치에 요소 찾아 포커스 설정
              FocusManager.setFocusByTouch(endX, endY);
            }
            
            // 마지막 탭 정보 저장 (더블 탭 감지용)
            this.lastTapTime = endTime;
            this.lastTapX = endX;
            this.lastTapY = endY;
          }
          
          e.preventDefault();
        },
        
        // 더블 탭 처리
        handleDoubleTap: function(x, y) {
          // 현재 포커스된 요소 가져오기
          const currentElement = FocusManager.getCurrentElement();
          
          if (currentElement) {
            // 요소 유형에 따른 처리
            if (currentElement.tagName === 'BUTTON') {
              // 버튼 클릭 이벤트 발생
              currentElement.click();
            } 
            else if (currentElement.tagName === 'INPUT' && currentElement.type === 'checkbox') {
              // 체크박스 상태 토글
              const previousChecked = currentElement.checked;
              
              // 다른 체크박스 선택 상태 확인 (같은 카테고리 내)
              const form = currentElement.closest('form');
              if (form) {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                let anyChecked = false;
                
                Array.from(checkboxes).forEach(checkbox => {
                  if (checkbox !== currentElement && checkbox.checked) {
                    anyChecked = true;
                  }
                });
                
                // 이미 다른 체크박스가 선택되어 있고, 현재 체크박스가 선택되지 않은 상태라면
                if (anyChecked && !previousChecked) {
                  SpeechManager.alert('이미 하나의 상품을 선택하셨습니다');
                  return;
                }
              }
              
              // 체크박스 상태 변경
              currentElement.checked = !previousChecked;
              
              // 상태 변경 후 음성 피드백
              SpeechManager.speakElementInfo(currentElement);
              
              // change 이벤트 발생
              const event = new Event('change', { bubbles: true });
              currentElement.dispatchEvent(event);
            }
          }
        },
        
        // 스와이프 처리
        handleSwipe: function(direction, isFastSwipe) {
          // 빠른 스와이프인 경우 음성 중단 플래그 설정
          if (isFastSwipe) {
            // 빠른 스와이프면 진행 중인 일반 음성 출력 중단
            if (window.speechSynthesis.speaking && !SpeechManager.isSpeakingAlert) {
              window.speechSynthesis.cancel();
            }
          }
          
          // 스와이프 방향에 따른 포커스 이동
          if (direction === 'right') {
            // 오른쪽 스와이프: 다음 요소로 이동
            FocusManager.moveFocus(1);
          } else if (direction === 'left') {
            // 왼쪽 스와이프: 이전 요소로 이동
            FocusManager.moveFocus(-1);
          }
        }
      };

      /**
       * 4. AppStateManager: 애플리케이션 상태 관리
       * - 모달 관리
       * - 체크박스 선택 관리
       * - 다음 버튼 처리
       */
      const AppStateManager = {
        activeModal: null, // 현재 활성화된 모달
        googleFormUrl: 'https://docs.google.com/forms/d/e/1FAIpQLSdGuFNDeGYBBHT9Dby7o5Yp0YAmxxwg3njEfaR7uP1JYJipFw/', // Google 폼 URL
        
        init: function() {
          // 카테고리 버튼 클릭 이벤트 리스너 설정
          this.setupCategoryButtons();
          
          // 뒤로가기 버튼 이벤트 리스너 설정
          this.setupBackButtons();
          
          // 다음 버튼 이벤트 리스너 설정
          this.setupNextButtons();
          
          // 체크박스 이벤트 리스너 설정
          this.setupCheckboxes();
        },
        
        // 카테고리 버튼 이벤트 리스너 설정
        setupCategoryButtons: function() {
          const categoryButtons = document.querySelectorAll('.category-buttons .btn');
          
          categoryButtons.forEach(button => {
            button.addEventListener('click', (e) => {
              const categoryId = button.id.replace('btn-category-', '');
              this.openModal(categoryId);
            });
          });
        },
        
        // 뒤로가기 버튼 이벤트 리스너 설정
        setupBackButtons: function() {
          const backButtons = document.querySelectorAll('.btn-back');
          
          backButtons.forEach(button => {
            button.addEventListener('click', (e) => {
              this.closeModal();
            });
          });
        },
        
        // 다음 버튼 이벤트 리스너 설정
        setupNextButtons: function() {
          const nextButtons = document.querySelectorAll('.btn-next');
          
          nextButtons.forEach(button => {
            button.addEventListener('click', (e) => {
              // 모달 ID 추출 (btn-next-from-{category})
              const modalId = button.id.replace('btn-next-from-', '');
              
              // 체크박스 선택 여부 확인
              this.handleNextButton(modalId);
            });
          });
        },
        
        // 체크박스 이벤트 리스너 설정
        setupCheckboxes: function() {
          const checkboxes = document.querySelectorAll('input[type="checkbox"]');
          
          checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
              // 같은 폼 내 다른 체크박스 선택 해제
              const form = checkbox.closest('form');
              if (form && checkbox.checked) {
                const otherCheckboxes = form.querySelectorAll('input[type="checkbox"]');
                otherCheckboxes.forEach(otherCheckbox => {
                  if (otherCheckbox !== checkbox && otherCheckbox.checked) {
                    otherCheckbox.checked = false;
                  }
                });
              }
            });
          });
        },
        
        // 모달 열기
        openModal: function(categoryId) {
          const modal = document.getElementById(`modal-${categoryId}`);
          if (!modal) return;
          
          // 이전 모달이 있으면 닫기
          if (this.activeModal) {
            this.activeModal.classList.remove('modal-open');
            this.activeModal.setAttribute('aria-hidden', 'true');
          }
          
          // 새 모달 열기
          modal.classList.add('modal-open');
          modal.setAttribute('aria-hidden', 'false');
          this.activeModal = modal;
          
          // 앱 컨테이너에 modal-active 클래스 추가
          const appContainer = document.getElementById('app-container');
          appContainer.classList.add('modal-active');
          
          // 포커스 관리자에 새 컨테이너 설정
          FocusManager.setCurrentContainer(modal);
        },
        
        // 모달 닫기
        closeModal: function() {
          if (!this.activeModal) return;
          
          // 모달 닫기
          this.activeModal.classList.remove('modal-open');
          this.activeModal.setAttribute('aria-hidden', 'true');
          this.activeModal = null;
          
          // 앱 컨테이너에서 modal-active 클래스 제거
          const appContainer = document.getElementById('app-container');
          appContainer.classList.remove('modal-active');
          
          // 포커스 관리자에 홈 화면 설정
          const homeScreen = document.getElementById('home-screen');
          FocusManager.setCurrentContainer(homeScreen);
        },
        
        // 다음 버튼 처리
        handleNextButton: function(modalId) {
          // 해당 모달의 폼 찾기
          const form = document.getElementById(`form-${modalId}`);
          if (!form) return;
          
          // 체크박스 선택 여부 확인
          const checkedBox = form.querySelector('input[type="checkbox"]:checked');
          
          if (!checkedBox) {
            // 선택된 상품 없음 알림
            SpeechManager.alert('상품을 선택해주세요');
            return;
          }
          
          // 선택된 상품의 가격 추출
          const price = checkedBox.value;
          
          // Google 폼으로 이동 (가격 정보 전달)
          window.location.href = this.googleFormUrl + `viewform?entry.1867939657=${price}`;
        }
      };

      // 애플리케이션 초기화 함수
      function initApp() {
        // 각 모듈 초기화
        if (!SpeechManager.init()) {
          console.error('음성 출력 모듈 초기화 실패');
          return;
        }
        
        FocusManager.init();
        TouchGestureManager.init();
        AppStateManager.init();
        
        // 초기 화면 메시지 출력
        const h1Element = document.querySelector('#home-screen h1');
        if (h1Element) {
          SpeechManager.speakElementInfo(h1Element);
        }
      }

      // DOM 로드 완료 시 애플리케이션 초기화
      document.addEventListener('DOMContentLoaded', initApp);

    })();
    </script>
</body>
</html>